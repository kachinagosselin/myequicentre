<!-- This is the user inbox. -->
<div class="white-background">
<div class="row-fluid">
<div class="span3" >
    <div class="nav messages-sidenav" >    
        <ul class="nav-list">
          <li><div class="compose"><button class="btn btn-block" type="button"><%= link_to 'Compose Message', new_user_message_path(@user) %></button></div></li>
          <li class="divider-horizontal"></li>
          <li class="active"><%= link_to 'Inbox', user_messages_path(@user) %></li>
          <li class="divider-horizontal"></li>
          <li><%= link_to 'Drafts', user_messages_drafts_path(@user) %></li>
          <li class="divider-horizontal"></li>
          <li><%= link_to 'Sent', user_messages_sent_path(@user)  %></li>
          <li class="divider-horizontal"></li>
          <li><%= link_to 'Archive', user_messages_archive_path(@user)  %></li>
          <li class="divider-horizontal"></li>
          <li><%= link_to 'Trash', user_messages_trash_path(@user)  %></li>
        </ul>
    </div>
</div>
<div class="span9">
<h1>Welcome to Your Message Center</h1>
</br>
<table class="table">
  <tr>
    <th>From name</th>
    <th>Title</th>
    <th>Content</th>
    <th></th>
    <th></th>
  </tr>

<% @user = current_user %>
<% @distinct_messages = @user.messages.select("DISTINCT(PARENT_ID)") %>
<% if @distinct_messages %>
<% @distinct_messages.each do |m| %>
<% @messages = @user.messages.find(:all, :conditions => { :parent_id => m.parent_id }) %>
<% @messages.sort_by(&:thread_count) %>
<% message = @messages[-1] %>
<% if message.folder == "inbox" %>
  <tr>
    <td><%= message.from_name %></td>
    <td><%= link_to message.title,  user_message_path(@user, message) %></td>
    <td><%= message.updated_at.in_time_zone('Hawaii').to_formatted_s(:long_ordinal) %></td>
    <td><%= link_to 'Archive', {:controller => 'messages', :action => 'archive', :id => message.id} %></td>
    <td><%= link_to 'Trash', {:controller => 'messages', :action => 'trash', :id => message.id} %></td>
  </tr>
<% end %>
<% end %>
<% end %>
</table>

<br />

</div>
</div>
</div>